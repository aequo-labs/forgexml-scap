<oval_definitions 
	xmlns="http://oval.mitre.org/XMLSchema/oval-definitions-5" 
	xmlns:ind="http://oval.mitre.org/XMLSchema/oval-definitions-5#independent" 
	xmlns:linux="http://oval.mitre.org/XMLSchema/oval-definitions-5#linux" 
	xmlns:oval="http://oval.mitre.org/XMLSchema/oval-common-5" 
	xmlns:unix="http://oval.mitre.org/XMLSchema/oval-definitions-5#unix" 
	xmlns:shell="http://oval.mitre.org/XMLSchema/oval-definitions-5#cmd" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://oval.mitre.org/XMLSchema/oval-definitions-5 
						http://oval.mitre.org/language/version5.11/ovaldefinition/complete/oval-definitions-schema.xsd 	
						http://oval.mitre.org/XMLSchema/oval-common-5 
						http://oval.mitre.org/language/version5.11/ovaldefinition/complete/oval-common-schema.xsd 
						http://oval.mitre.org/XMLSchema/oval-definitions-5#cmd x-shellcommand-schema.xsd 
						http://oval.mitre.org/XMLSchema/oval-definitions-5#linux 
						http://oval.mitre.org/language/version5.11/ovaldefinition/complete/linux-definitions-schema.xsd 
						http://oval.mitre.org/XMLSchema/oval-definitions-5#independent 
						http://oval.mitre.org/language/version5.11/ovaldefinition/complete/independent-definitions-schema.xsd 
						http://oval.mitre.org/XMLSchema/oval-definitions-5#unix 
						http://oval.mitre.org/language/version5.10/ovaldefinition/complete/unix-definitions-schema.xsd">

	<generator>
		<oval:product_name>CimTrak Agent Debian-like OVAL</oval:product_name>
		<oval:schema_version>5.11</oval:schema_version>
		<oval:timestamp>2025-07-25T14:00:00+00:00</oval:timestamp>
	</generator>
	
	<definitions>
		<!-- CimTrak Agent Service Definition -->
		<definition 
			class="compliance" 
			id="oval:com.cimcor.cimtrak.o_debian:def:5001" 
			version="1">
			<metadata>
				<title>Ensure CimTrakAgent service is enabled and active</title>
				<description>Verify that the CimTrakAgent systemd service is both enabled for auto-start and currently active/running</description>
			</metadata>
			<criteria operator="AND" negate="false">
				<criterion negate="false" test_ref="oval:com.cimcor.cimtrak.o_debian:tst:5001" comment="CimTrakAgent service is enabled"/>
				<criterion negate="false" test_ref="oval:com.cimcor.cimtrak.o_debian:tst:5002" comment="CimTrakAgent service is active"/>
			</criteria>
		</definition>
		
		<!-- CimTrak Agent Configuration Definition -->
		<definition 
			class="compliance" 
			id="oval:com.cimcor.cimtrak.o_debian:def:5002" 
			version="1">
			<metadata>
				<title>Ensure CimTrakAgent is properly configured</title>
				<description>Verify that CimTrakAgent --checkinstall command returns success (exit code 0)</description>
			</metadata>
			<criteria operator="AND" negate="false">
				<criterion negate="false" test_ref="oval:com.cimcor.cimtrak.o_debian:tst:5003" comment="CimTrakAgent --checkinstall succeeds"/>
			</criteria>
		</definition>
	</definitions>

	<tests>
		<!-- Service Status Tests -->
		<linux:systemdunitproperty_test 
			check="all" 
			check_existence="at_least_one_exists" 
			comment="CimTrakAgent service is enabled" 
			id="oval:com.cimcor.cimtrak.o_debian:tst:5001" 
			version="1">
			<linux:object object_ref="oval:com.cimcor.cimtrak.o_debian:obj:5001"/>
			<linux:state state_ref="oval:com.cimcor.cimtrak.o_debian:ste:5001"/>
		</linux:systemdunitproperty_test>
		
		<linux:systemdunitproperty_test 
			check="all" 
			check_existence="at_least_one_exists" 
			comment="CimTrakAgent service is active" 
			id="oval:com.cimcor.cimtrak.o_debian:tst:5002" 
			version="1">
			<linux:object object_ref="oval:com.cimcor.cimtrak.o_debian:obj:5002"/>
			<linux:state state_ref="oval:com.cimcor.cimtrak.o_debian:ste:5002"/>
		</linux:systemdunitproperty_test>
		
		<!-- CimTrak Agent Configuration Test -->
		<shellcommand_test 
			xmlns="http://oval.mitre.org/XMLSchema/oval-definitions-5#cmd" 
			check="at least one" 
			check_existence="at_least_one_exists" 
			comment="CimTrakAgent --checkinstall returns success" 
			id="oval:com.cimcor.cimtrak.o_debian:tst:5003" 
			version="1">
			<object object_ref="oval:com.cimcor.cimtrak.o_debian:obj:5003"/>
			<state state_ref="oval:com.cimcor.cimtrak.o_debian:ste:5003"/>
		</shellcommand_test>
	</tests>

	<objects>
		<!-- Service Status Objects -->
		<linux:systemdunitproperty_object 
			comment="CimTrakAgent service UnitFileState" 
			id="oval:com.cimcor.cimtrak.o_debian:obj:5001" 
			version="1">
			<linux:unit>CimTrakAgent.service</linux:unit>
			<linux:property>UnitFileState</linux:property>
		</linux:systemdunitproperty_object>
		
		<linux:systemdunitproperty_object 
			comment="CimTrakAgent service ActiveState" 
			id="oval:com.cimcor.cimtrak.o_debian:obj:5002" 
			version="1">
			<linux:unit>CimTrakAgent.service</linux:unit>
			<linux:property>ActiveState</linux:property>
		</linux:systemdunitproperty_object>
		
		<!-- CimTrak Agent Configuration Object -->
		<shellcommand_object 
			xmlns="http://oval.mitre.org/XMLSchema/oval-definitions-5#cmd" 
			comment="CimTrakAgent --checkinstall command with filtered output" 
			id="oval:com.cimcor.cimtrak.o_debian:obj:5003" 
			version="1">
			<command>cd /opt/Cimcor/CimTrak/CimTrakAgent &amp;&amp; (./CimTrakAgent.exe --checkinstall 2>&amp;1 | grep -E "(cta_rtn=|CimTrak Version|Linux real time detection|OpenSSL Session|SetConnected:)" || true); echo "EXIT_CODE:$?"</command>
		</shellcommand_object>
		
	</objects>
	
	<states>
		<!-- Service Status States -->
		<linux:systemdunitproperty_state 
			comment="CimTrakAgent service is enabled" 
			id="oval:com.cimcor.cimtrak.o_debian:ste:5001" 
			version="1">
			<linux:value datatype="string" operation="equals">enabled</linux:value>
		</linux:systemdunitproperty_state>
		
		<linux:systemdunitproperty_state 
			comment="CimTrakAgent service is active" 
			id="oval:com.cimcor.cimtrak.o_debian:ste:5002" 
			version="1">
			<linux:value datatype="string" operation="equals">active</linux:value>
		</linux:systemdunitproperty_state>
		
		<!-- CimTrak Agent Configuration State -->
		<shellcommand_state 
			xmlns="http://oval.mitre.org/XMLSchema/oval-definitions-5#cmd" 
			comment="CimTrakAgent --checkinstall returns success (exit code 0 via stdout)" 
			id="oval:com.cimcor.cimtrak.o_debian:ste:5003" 
			version="1">
			<stdout_line entity_check="at least one" operation="equals">EXIT_CODE:0</stdout_line>
		</shellcommand_state>
		
	</states>
</oval_definitions>